name: Build
on:
  workflow_dispatch:
jobs:
  build_android:
    permissions:
      contents: write
    runs-on: ubuntu-latest
    steps:
      - name: Install Android NDK
        run: |
          echo "export CARGO_TARGET_AARCH64_LINKER=$(pwd)/toolchains/llvm/prebuilt/linux-x86_64/bin/aarch64-linux-android35-clang" >> $GITHUB_ENV
          echo "CARGO_TARGET_AARCH64_LINKER is $CARGO_TARGET_AARCH64_LINKER"

        # run: |
        #   wget https://dl.google.com/android/repository/android-ndk-r27-linux.zip
        #   unzip -qq android-ndk-r27-linux.zip
        #   cd android-ndk-r27
        #   mv android-ndk-r27 android-ndk
        #   echo "export ANDROID_NDK_ROOT=\$GITHUB_ACTION_PATH/usr/lib/android-ndk" >> $GITHUB_ENV
      
      # - name: Build c-api
      #   run:

      # - name: Checkout the repository
      #   uses: actions/checkout@v4
      #   with:
      #     repository: 'RazrFalcon/resvg'
      #     fetch-depth: 0

      # - name: Get the latest tag
      #   run: |
      #     latest_tag=$(git describe --tags `git rev-list --tags --max-count=1`)
      #     echo "Latest tag: $latest_tag"
      #     echo "latest_tag=$latest_tag" >> $GITHUB_ENV
      # - name: Checkout latest tag
      #   run: git checkout ${{ env.latest_tag }}

  #     - name: Build c-api
  #       run: |
  #         cd crates/c-api
  #         rustup target add aarch64-linux-android


  # build_ios:
  #   permissions:
  #     contents: write
  #   runs-on: macos-latest
  #   steps:
  #     - name: Checkout the repository
  #       uses: actions/checkout@v4
  #       with:
  #         repository: 'RazrFalcon/resvg'
  #         fetch-depth: 0

  #     - name: Get the latest tag
  #       run: |
  #         latest_tag=$(git describe --tags `git rev-list --tags --max-count=1`)
  #         echo "Latest tag: $latest_tag"
  #         echo "latest_tag=$latest_tag" >> $GITHUB_ENV
  #     - name: Checkout latest tag
  #       run: git checkout ${{ env.latest_tag }}

  #     - name: Build c-api
  #       run: |
  #         cd crates/c-api
  #         rustup target add aarch64-apple-ios
  #         cargo build --target aarch64-apple-ios --release --no-default-features

  #     - name: Zip
  #       run: |
  #         cd target/aarch64-apple-ios/release
  #         zip libresvg.zip libresvg.a
      
  #     - name: Release
  #       uses: softprops/action-gh-release@v2
  #       with:
  #         tag_name: ${{ env.latest_tag }}
  #         files: target/aarch64-apple-ios/release/libresvg.zip
